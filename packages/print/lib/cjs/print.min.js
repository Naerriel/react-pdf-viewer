"use strict";var e=require("@react-pdf-viewer/core"),t=require("react"),n=require("react-dom");function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a=r(t),o=function(){return a.createElement(e.Icon,{size:16},a.createElement("path",{d:"M7.5,19.499h9 M7.5,16.499h9 M5.5,16.5h-3c-1.103-0.003-1.997-0.897-2-2v-6c0.003-1.103,0.897-1.997,2-2h19\n            c1.103,0.003,1.997,0.897,2,2v6c-0.003,1.103-0.897,1.997-2,2h-3\n            M5.5,4.5v-4h9.586c0.265,0,0.52,0.105,0.707,0.293l2.414,2.414\n            C18.395,3.394,18.5,3.649,18.5,3.914V4.5\n            M18.5,22.5c0,0.552-0.448,1-1,1h-11c-0.552,0-1-0.448-1-1v-9h13V22.5z\n            M3.5,8.499\n            c0.552,0,1,0.448,1,1s-0.448,1-1,1s-1-0.448-1-1S2.948,8.499,3.5,8.499z\n            M14.5,0.499v4h4"}))},i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var c,u=function(t){var n=t.enableShortcuts,r=t.onClick,i=a.useContext(e.LocalizationContext).l10n,c=i&&i.print?i.print.print:"Print",u=n?e.isMac()?"Meta+P":"Ctrl+P":"";return a.createElement(e.Tooltip,{ariaControlsSuffix:"print",position:e.Position.BottomCenter,target:a.createElement(e.MinimalButton,{ariaKeyShortcuts:u,ariaLabel:c,testId:"print__button",onClick:r},a.createElement(o,null)),content:function(){return c}})};!function(e){e.CheckingPermission="CheckingPermission",e.Inactive="Inactive",e.Preparing="Preparing",e.Cancelled="Cancelled",e.Ready="Ready"}(c||(c={}));var s=function(e){var t=e.children,n=e.enableShortcuts,r=e.store;return(t||u)({enableShortcuts:n,onClick:function(){r.update("printStatus",c.CheckingPermission)}})},l=function(t){var n=t.doc,r=t.store,o=a.useContext(e.LocalizationContext).l10n,i=a.useState(!0),u=i[0],s=i[1];return a.useEffect((function(){n.getPermissions().then((function(e){null===e||e.includes(4)||e.includes(2048)?r.update("printStatus",c.Preparing):s(!1)}))}),[]),u?a.createElement(a.Fragment,null):a.createElement(e.Modal,{ariaControlsSuffix:"print-permission",closeOnClickOutside:!1,closeOnEscape:!1,content:function(t){return a.createElement(a.Fragment,null,a.createElement("div",{className:"rpv-print__permission-body"},o&&o.print?o.print.disallowPrint:"The document does not allow to print"),a.createElement("div",{className:"rpv-print__permission-footer"},a.createElement(e.Button,{onClick:function(){t(),r.update("printStatus",c.Cancelled)}},o&&o.print?o.print.close:"Close")))},isOpened:!0})},p=function(t){var n=t.numLoadedPages,r=t.numPages,o=t.onCancel,i=a.useContext(e.LocalizationContext).l10n,c=a.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,u=Math.floor(100*n/r);return a.createElement("div",{className:"rpv-print__progress"},a.createElement("div",{className:e.classNames({"rpv-print__progress-body":!0,"rpv-print__progress-body--rtl":c})},a.createElement("div",{className:"rpv-print__progress-message"},i&&i.print?i.print.preparingDocument:"Preparing document ..."),a.createElement("div",{className:"rpv-print__progress-bar"},a.createElement(e.ProgressBar,{progress:u})),a.createElement(e.Button,{onClick:o},i&&i.print?i.print.cancel:"Cancel")))},m=function(t){var n=t.canvas,r=t.page,o=t.pageHeight,i=t.pageIndex,c=t.pageWidth,u=t.rotation,s=t.onLoad,l=a.useRef(),p=e.useSafeState(""),m=p[0],d=p[1],f=a.useMemo((function(){return"undefined"!=typeof process&&void 0!==process.env.JEST_WORKER_ID}),[]);return a.useEffect((function(){var e=l.current;e&&e.cancel();var t=150/72;n.height=Math.floor(o*t),n.width=Math.floor(c*t);var a=n.getContext("2d");a.save(),a.fillStyle="rgb(255, 255, 255)",a.fillRect(0,0,n.width,n.height),a.restore();var i=r.getViewport({rotation:u,scale:1});l.current=r.render({canvasContext:a,intent:"print",transform:[t,0,0,t,0,0],viewport:i}),l.current.promise.then((function(){"toBlob"in n&&"createObjectURL"in URL?n.toBlob((function(e){d(URL.createObjectURL(e)),f&&s()})):(d(n.toDataURL()),f&&s())}),(function(){}))}),[]),m&&a.createElement("div",{className:"rpv-print__page"},a.createElement("img",{"data-testid":"print__thumbnail-".concat(i),src:m,onLoad:function(){f||s()}}))},d=function(t){var n=t.canvas,r=t.doc,o=t.pageIndex,i=t.pageRotation,c=t.pageSize,u=t.rotation,s=t.shouldRender,l=t.onLoad,p=e.useSafeState(null),d=p[0],f=p[1],g=Math.abs(u+i)%180==0;a.useEffect((function(){s&&e.getPage(r,o).then((function(e){f(e)}))}),[s]);var v=(c.rotation+u+i)%360;return d&&a.createElement(m,{canvas:n,page:d,pageHeight:g?c.pageHeight:c.pageWidth,pageIndex:o,pageWidth:g?c.pageWidth:c.pageHeight,rotation:v,onLoad:l})},f=function(e){var t=e.doc,r=e.numLoadedPages,o=e.pagesRotation,i=e.pageSizes,u=e.printPages,s=e.printStatus,l=e.rotation,p=e.onCancel,m=e.onLoad,f=a.useMemo((function(){return document.createElement("canvas")}),[]),g=a.useMemo((function(){var e=document.querySelector(".rpv-print__zone");if(e)return e;var t=document.createElement("div");return t.classList.add("rpv-print__zone"),t.setAttribute("data-testid","print__zone"),document.body.appendChild(t),t}),[]);a.useEffect((function(){s===c.Ready&&(document.documentElement.classList.add("rpv-print__html-printing"),document.body.classList.add("rpv-print__body-printing"),window.print());var e=function(){if(s===c.Ready){document.documentElement.classList.remove("rpv-print__html-printing"),document.body.classList.remove("rpv-print__body-printing");var t=document.querySelectorAll(".rpv-print__zone");t&&t.forEach((function(e){e.parentElement.removeChild(e)})),f.height=0,f.width=0,document.removeEventListener("mousemove",e),p()}};return document.addEventListener("mousemove",e),function(){return document.removeEventListener("mousemove",e)}}),[s]);var v=i[0].pageHeight,h=i[0].pageWidth;return n.createPortal(a.createElement(a.Fragment,null,u.map((function(e,n){return a.createElement(d,{key:e,canvas:f,doc:t,pageIndex:e,pageRotation:o.has(e)?o.get(e):0,pageSize:i[e],rotation:l,shouldRender:n===r,onLoad:m})})),a.createElement("style",{dangerouslySetInnerHTML:{__html:"@page { size: ".concat(h,"pt ").concat(v,"pt }")}})),g)},g=function(e){var t=e.doc,n=e.pagesRotation,r=e.pageSizes,o=e.renderProgressBar,i=e.rotation,u=e.setPages,s=e.store,m=a.useState(c.Inactive),d=m[0],g=m[1],v=a.useState(0),h=v[0],E=v[1],P=a.useMemo((function(){var e=t.numPages;return u(t).filter((function(t){return t>=0&&t<e}))}),[t,u]),C=P.length,b=function(){E(0),g(c.Inactive)},S=function(e){return g(e)};return a.useEffect((function(){return s.subscribe("printStatus",S),function(){s.unsubscribe("printStatus",S)}}),[]),a.createElement(a.Fragment,null,d===c.CheckingPermission&&a.createElement(l,{doc:t,store:s}),d===c.Preparing&&(o?o(h,C,b):a.createElement(p,{numLoadedPages:h,numPages:C,onCancel:b})),(d===c.Preparing||d===c.Ready)&&h<=C&&a.createElement(f,{doc:t,numLoadedPages:h,pagesRotation:n,pageSizes:r,printPages:P,printStatus:d,rotation:i,onCancel:b,onLoad:function(){var e=h+1;e<=C&&(E(e),e===C&&g(c.Ready))}}))},v=function(t){var n=t.onClick,r=a.useContext(e.LocalizationContext).l10n,i=r&&r.print?r.print.print:"Print";return a.createElement(e.MenuItem,{icon:a.createElement(o,null),testId:"print__menu",onClick:n},i)},h=function(t){var n=t.containerRef,r=t.store,o=a.useState(n.current),i=o[0],u=o[1];a.useEffect((function(){n.current!==i&&u(n.current)}),[]);var s=a.useCallback((function(t){!i||t.shiftKey||t.altKey||"p"!==t.key||(e.isMac()?t.metaKey:t.ctrlKey)&&document.activeElement&&i.contains(document.activeElement)&&(t.preventDefault(),r.update("printStatus",c.Preparing))}),[i]);return a.useEffect((function(){if(i)return document.addEventListener("keydown",s),function(){document.removeEventListener("keydown",s)}}),[i]),a.createElement(a.Fragment,null)};exports.PrintIcon=o,exports.getAllPagesNumbers=function(e){return Array(e.numPages).fill(0).map((function(e,t){return t}))},exports.getCustomPagesNumbers=function(e){return function(t){var n,r=[];return e.replace(/\s+/g,"").split(",").forEach((function(e){var t,n,a=e.split("-").map((function(e){return parseInt(e,10)})).filter((function(e){return Number.isInteger(e)}));1===a.length?r.push(a[0]-1):2===a.length&&r.push.apply(r,(t=a[0]-1,n=a[1]-1,Array(n-t+1).fill(0).map((function(e,n){return t+n}))))})),(n=r,n.filter((function(e){return n.indexOf(e)===n.lastIndexOf(e)}))).filter((function(e){return e>=0&&e<t.numPages}))}},exports.getEvenPagesNumbers=function(e){return Array(e.numPages).fill(0).map((function(e,t){return t})).filter((function(e){return(e+1)%2==0}))},exports.getOddPagesNumbers=function(e){return Array(e.numPages).fill(0).map((function(e,t){return t})).filter((function(e){return(e+1)%2==1}))},exports.printPlugin=function(t){var n=a.useMemo((function(){return Object.assign({},{enableShortcuts:!0,setPages:function(e){return Array(e.numPages).fill(0).map((function(e,t){return t}))}},t)}),[]),r=a.useMemo((function(){return e.createStore({printStatus:c.Inactive})}),[]),o=function(e){return a.createElement(s,i({enableShortcuts:n.enableShortcuts},e,{store:r}))};return{print:function(){r.update("printStatus",c.CheckingPermission)},renderViewer:function(e){var o=e.slot,c={children:a.createElement(a.Fragment,null,n.enableShortcuts&&a.createElement(h,{containerRef:e.containerRef,store:r}),a.createElement(g,{doc:e.doc,pagesRotation:e.pagesRotation,pageSizes:e.pageSizes,renderProgressBar:null==t?void 0:t.renderProgressBar,rotation:e.rotation,setPages:n.setPages,store:r}),o.children)};return i(i({},o),c)},Print:o,PrintButton:function(){return a.createElement(o,null,(function(e){return a.createElement(u,i({},e))}))},PrintMenuItem:function(e){return a.createElement(o,null,(function(t){return a.createElement(v,{onClick:function(){t.onClick(),e.onClick()}})}))},setPages:function(e){n.setPages=e}}};
